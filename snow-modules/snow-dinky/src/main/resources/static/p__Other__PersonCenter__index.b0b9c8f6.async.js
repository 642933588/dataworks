"use strict";(self.webpackChunkdinky_web=self.webpackChunkdinky_web||[]).push([[7670],{20668:function(oe,N,r){var H=r(97857),x=r.n(H),J=r(15009),u=r.n(J),Q=r(99289),T=r.n(Q),X=r(79935),a=r(41913),D=r(5966),e=r(97269),_=r(14726),ae=r(67294),l=r(85893),q=function(n){var K=n.values,I=n.form,v=n.renderSubmit,$=v===void 0?!1:v,Y=n.onSubmit,ee=function(){var F=T()(u()().mark(function b(){var C,P,U,f;return u()().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return L.next=2,I==null?void 0:I.validateFields();case 2:C=L.sent,Y&&(P=C.password,U=C.newPassword,f=C.newPasswordCheck,Y({id:K.id,newPassword:U,newPasswordCheck:f,password:P,username:K.username}));case 4:case"end":return L.stop()}},b)}));return function(){return F.apply(this,arguments)}}(),re=function(){return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(D.Z.Password,{width:"xl",name:"password",hasFeedback:!0,label:(0,a.l)("user.oldpwd"),placeholder:(0,a.l)("user.oldpwdPlaceholder"),rules:[{required:!0,message:(0,a.l)("user.oldpwdPlaceholder")}]}),(0,l.jsx)(D.Z.Password,{width:"xl",name:"newPassword",hasFeedback:!0,label:(0,a.l)("user.newpwd"),placeholder:(0,a.l)("user.newpwdPlaceholder"),rules:[{required:!0,message:(0,a.l)("user.newpwdPlaceholder")}]}),(0,l.jsx)(D.Z.Password,{width:"xl",name:"newPasswordCheck",hasFeedback:!0,dependencies:["newPassword"],label:(0,a.l)("user.repeatpwd"),placeholder:(0,a.l)("user.repeatpwdPlaceholder"),rules:[{required:!0,message:(0,a.l)("user.oldNewPwdNoMatch")},function(b){var C=b.getFieldValue;return{validator:function(U,f){return!f||C("newPassword")===f?Promise.resolve():Promise.reject(new Error((0,a.l)("user.oldNewPwdNoMatch")))}}}]})]})};return(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(e.A,x()(x()({},X.pA),{},{form:I,initialValues:K,layout:"horizontal",submitter:{render:function(b,C){return $?(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(_.ZP,{type:"primary",onClick:T()(u()().mark(function P(){return u()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,ee();case 2:case"end":return f.stop()}},P)})),children:(0,a.l)("button.submit")})}):(0,l.jsx)(l.Fragment,{})}},children:re()}))})};N.Z=q},42571:function(oe,N,r){r.r(N),r.d(N,{default:function(){return Ze}});var H=r(15009),x=r.n(H),J=r(97857),u=r.n(J),Q=r(99289),T=r.n(Q),X=r(5574),a=r.n(X),D=r(96012),e=r(85893),_=function(d){var t=d.children,o=(0,D.q_)({from:{transform:"scale(0)",opacity:0},to:{transform:"scale(1)",opacity:1},config:{tension:300,friction:20}});return(0,e.jsx)(D.q.div,{style:o,children:t})},ae=_,l=r(95034),q=r(79659),le=r(20668),n=r(41913),K=r(7134),I=r(96074),v=r(11198),$=r(66309),Y=function(d){var t=d.user,o=d.tenant;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(K.C,{style:{alignSelf:"center",marginBottom:50},draggable:!0,size:200,src:t.avatar}),(0,e.jsx)(I.Z,{orientation:"left",plain:!0,children:(0,n.l)("user.info")}),(0,e.jsxs)(v.Z,{size:"small",column:2,children:[(0,e.jsx)(v.Z.Item,{label:(0,n.l)("user.username"),children:t.username}),(0,e.jsx)(v.Z.Item,{label:(0,n.l)("user.nickname"),children:t.nickname}),(0,e.jsx)(v.Z.Item,{label:(0,n.l)("user.phone"),children:t.mobile}),(0,e.jsx)(v.Z.Item,{label:(0,n.l)("user.jobnumber"),children:t.worknum}),(0,e.jsx)(v.Z.Item,{label:(0,n.l)("user.current.tenant"),children:(0,e.jsx)($.Z,{color:"processing",children:o==null?void 0:o.tenantCode})})]})]})},ee=Y,re=r(17057),F=r(42075),b=r(27484),C=r.n(b),P=re.Z.Text,U=function(d){return d.filter(function(t){return!t.isDeleted}).map(function(t){var o=(0,e.jsxs)(F.Z,{direction:"vertical",children:[(0,e.jsxs)(P,{children:[(0,n.l)("user.username"),": ",t.username]}),(0,e.jsxs)(P,{type:t.status===10004?"success":"danger",children:[(0,n.l)("user.login.status.code"),": ",t.status]}),(0,e.jsxs)(P,{type:t.status===10004?"success":"danger",children:[(0,n.l)("user.login.status.msg"),": ",t.msg]})]}),g=(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)(F.Z,{direction:"vertical",children:[(0,e.jsxs)(P,{children:[(0,n.l)("user.login.accesstime"),": ",C()(t.accessTime).format("YYYY-MM-DD HH:mm:ss")]}),(0,e.jsxs)(P,{children:[(0,n.l)("user.login.ip"),": ",t.ip]})]})});return{key:t.id,color:t.status===10004?"green":"red",label:g,children:o}})},f=r(21953),G=r(58023),L=r(4393),k=r(14726),ie=r(57953),ue=r(12845),w=r(67294),de=function(d){var t=d.userId,o=(0,w.useState)([]),g=a()(o,2),c=g[0],Z=g[1],z=(0,w.useState)(!1),M=a()(z,2),E=M[0],j=M[1],i=(0,w.useCallback)(function(){var y=T()(x()().mark(function p(V){return x()().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return j(!0),B.next=3,(0,f.Ri)("".concat(G.Z.LOGIN_RECORD,"/").concat(V)).then(function(S){Z(S),j(!1)});case 3:case"end":return B.stop()}},p)}));return function(p){return y.apply(this,arguments)}}(),[t]);return(0,w.useEffect)(function(){i(t)},[t]),(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(L.Z,{bordered:!1,extra:(0,e.jsx)(k.ZP,{onClick:function(){return i(t)},children:(0,n.l)("button.refresh")}),size:"small",children:(0,e.jsx)(ie.Z,{spinning:E,children:(0,e.jsx)(ue.Z,{mode:"alternate",reverse:!0,items:U(c)})})})})},ce=de,ne=r(58461),he=r(67939),te=r(79935),me=r(85576),ve=function(d){var t=d.config,o=t.open,g=t.data,c=d.onCancel;return(0,e.jsx)(me.Z,u()(u()({title:(0,n.l)("global.result"),open:o},te.SU),{},{onCancel:c,okButtonProps:{hidden:!0},cancelText:(0,n.l)("button.close"),children:(0,e.jsx)(he.Z,{language:"json",height:"60vh",code:g})}))},fe=ve,ge=r(25538),je=r(88028),pe=function(d){var t=d.userId,o=(0,w.useState)({open:!1,data:""}),g=a()(o,2),c=g[0],Z=g[1],z=[{title:(0,n.l)("user.op.time"),dataIndex:"operateTime",valueType:"dateTime",hideInSearch:!0},{title:(0,n.l)("user.op.name"),dataIndex:"operateName",hideInSearch:!0},{title:(0,n.l)("user.op.module"),dataIndex:"moduleName",ellipsis:!0},{title:(0,n.l)("user.op.type"),dataIndex:"businessType"},{title:(0,n.l)("user.op.method"),dataIndex:"method",ellipsis:!0},{title:(0,n.l)("user.request.type"),dataIndex:"requestMethod",hideInSearch:!0},{title:(0,n.l)("user.op.params"),render:function(j,i){return(0,e.jsx)(k.ZP,{icon:(0,e.jsx)(ne.lW,{}),type:"link",onClick:function(){return Z({open:!0,data:i.operateParam})}})},hideInSearch:!0},{title:(0,n.l)("user.op.result"),dataIndex:"jsonResult",hideInSearch:!0,render:function(j,i){return(0,e.jsx)(k.ZP,{icon:(0,e.jsx)(ne.lW,{}),type:"link",onClick:function(){return Z({open:!0,data:i.jsonResult})}})}},{title:(0,n.l)("user.op.url"),dataIndex:"operateUrl",hideInSearch:!0},{title:(0,n.l)("user.op.ip"),dataIndex:"operateIp",hideInSearch:!0},{title:(0,n.l)("user.op.status"),dataIndex:"status",valueEnum:{1:{text:(0,n.l)("global.error"),status:"error"},0:{text:(0,n.l)("global.success"),status:"Success"}},hideInSearch:!0},{title:(0,n.l)("user.op.error.msg"),dataIndex:"errorMsg",render:function(j,i){return(0,e.jsx)(e.Fragment,{children:i.errorMsg?(0,e.jsx)(k.ZP,{icon:(0,e.jsx)(ne.lW,{}),type:"link",onClick:function(){return Z({open:!0,data:i.errorMsg})}}):(0,e.jsx)(e.Fragment,{children:"-"})})}}],M=function(){Z(function(j){return u()(u()({},j),{},{open:!1,data:""})})};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(je.Z,u()(u()({headerTitle:void 0,ghost:!0,options:!1,size:"small"},te.xc),{},{pagination:{position:["bottomCenter"],pageSize:18,hideOnSinglePage:!0,showQuickJumper:!0},request:function(){var E=T()(x()().mark(function j(i,y,p){return x()().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return R.next=2,(0,ge.et)("".concat(G.Z.OPERATE_LOG,"/").concat(t),u()(u()({},i),{},{sorter:y,filter:p}));case 2:return R.abrupt("return",R.sent);case 3:case"end":return R.stop()}},j)}));return function(j,i,y){return E.apply(this,arguments)}}(),columns:z})),(0,e.jsx)(fe,{onCancel:M,config:c})]})},xe=pe,Pe=r(87712),ye=r(57344),Se=r(76015),Ie=r(83832),Ce=r(11774),se=r(38345),Ee=r(18922),Re=function(){var d=Ee.Z.useForm(),t=a()(d,1),o=t[0],g=(0,ye.useModel)("@@initialState"),c=g.initialState,Z=g.setInitialState,z=(0,w.useState)("loginlog"),M=a()(z,2),E=M[0],j=M[1],i=(0,e.jsx)(Ie.S,{}),y=function(){var W=T()(x()().mark(function h(){var m,O;return x()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,c==null||(m=c.fetchUserInfo)===null||m===void 0?void 0:m.call(c);case 2:O=s.sent,O&&Z(function(Oe){return u()(u()({},Oe),{},{currentUser:O})});case 4:case"end":return s.stop()}},h)}));return function(){return W.apply(this,arguments)}}();if((0,w.useEffect)(function(){y()},[c==null?void 0:c.currentUser]),!c)return i;var p=c.currentUser;if(!p||!p.user.username)return i;var V=p.roleList,R=p.tenantList,B=p.currentTenant,S=p.user,Te=function(h){return h==null?void 0:h.map(function(m){return(0,e.jsx)(v.Z.Item,{children:(0,e.jsx)($.Z,{color:"success",children:m.tenantCode},m.id)},m.id)})},be=function(h){return h==null?void 0:h.map(function(m){return(0,e.jsx)(v.Z.Item,{children:(0,e.jsx)($.Z,{color:"success",children:m.roleCode},m.id)},m.id)})},Le=function(){var W=T()(x()().mark(function h(m){var O;return x()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,(0,f.vO)(G.Z.USER_MODIFY_PASSWORD,(0,n.l)("button.changePassword"),m);case 2:if(O=s.sent,!(O&&O.code===te.n8.SUCCESS)){s.next=11;break}return o.resetFields(),s.next=7,(0,Pe.kk)((0,n.l)("user.changePasswordSuccess"));case 7:if(s.t0=s.sent,!s.t0){s.next=11;break}return s.next=11,(0,q.r)();case 11:case"end":return s.stop()}},h)}));return function(m){return W.apply(this,arguments)}}(),we=[{key:"loginlog",label:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(l.vj,{}),(0,n.l)("user.loginlog")]}),children:(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(ce,{userId:S==null?void 0:S.id})})},{key:"operation",label:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(l.vj,{}),(0,n.l)("user.op")]}),children:(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(xe,{userId:S==null?void 0:S.id})})},{key:"changePassword",label:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Se.Z,{}),(0,n.l)("button.changePassword")]}),children:(0,e.jsx)(le.Z,{form:o,renderSubmit:!0,values:S,onSubmit:Le})}];return(0,e.jsx)(ae,{children:(0,e.jsx)(Ce._z,{title:!1,children:(0,e.jsxs)(se.Z,{ghost:!0,gutter:[16,16],hoverable:!0,loading:!i&&p,children:[(0,e.jsxs)(se.Z,{style:{height:"91vh",textAlign:"center",overflowY:"auto"},colSpan:"22%",hoverable:!0,bordered:!0,children:[(0,e.jsx)(ee,{user:S,tenant:B}),(0,e.jsx)(I.Z,{orientation:"left",plain:!0,children:(0,n.l)("user.tenant")}),(0,e.jsx)(v.Z,{size:"small",column:3,children:Te(R||[])}),(0,e.jsx)(I.Z,{plain:!0}),(0,e.jsx)(I.Z,{orientation:"left",plain:!0,children:(0,n.l)("user.role")}),(0,e.jsx)(v.Z,{size:"small",column:3,children:be(V||[])})]}),(0,e.jsx)(se.Z,{hoverable:!0,bordered:!0,style:{height:"91vh",textAlign:"center",overflowY:"auto"},tabs:{activeKey:E,type:"card",animated:!0,onChange:function(h){return j(h)},items:we}})]})})})},Ze=Re}}]);
