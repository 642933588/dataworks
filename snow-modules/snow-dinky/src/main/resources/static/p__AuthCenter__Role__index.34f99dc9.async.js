"use strict";(self.webpackChunkdinky_web=self.webpackChunkdinky_web||[]).push([[9941],{22284:function(w,L,e){e.d(L,{Z:function(){return x}});var U=e(87462),F=e(67294),f={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M888 792H200V168c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h752c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM288 604a64 64 0 10128 0 64 64 0 10-128 0zm118-224a48 48 0 1096 0 48 48 0 10-96 0zm158 228a96 96 0 10192 0 96 96 0 10-192 0zm148-314a56 56 0 10112 0 56 56 0 10-112 0z"}}]},name:"dot-chart",theme:"outlined"},N=f,n=e(13401),K=function(k,V){return F.createElement(n.Z,(0,U.Z)({},k,{ref:V,icon:N}))},R=F.forwardRef(K),x=R},69349:function(w,L,e){e.d(L,{e9:function(){return P},g9:function(){return Y},ge:function(){return I},od:function(){return G},x:function(){return z}});var U=e(97857),F=e.n(U),f=e(7646),N=e(41913),n=e(26598),K=e(42075),R=e(67294),x=e(85893),I=function(c){var i=c.icon;return i?R.createElement(n[i]):null},k=function(c){switch(c){case"F":return(0,x.jsx)(x.Fragment,{children:(0,N.l)("menu.type.button")});case"M":return(0,x.jsx)(x.Fragment,{children:(0,N.l)("menu.type.dir")});case"C":return(0,x.jsx)(x.Fragment,{children:(0,N.l)("menu.type.menu")});default:return null}},V=function(c){return(0,x.jsxs)(K.Z,{children:[c.perms&&(0,x.jsxs)("span",{style:{color:"grey"},children:["\xA0\xA0\xA0",c.perms]}),c.type&&(0,x.jsxs)("span",{style:{color:"grey"},children:["\xA0\xA0\xA0",k(c.type)]}),c.note&&(0,x.jsxs)("span",{style:{color:"grey"},children:["\xA0\xA0\xA0",c.note]}),c.path&&(0,x.jsxs)("span",{style:{color:"grey"},children:["\xA0\xA0\xA0",c.path]})]})},Y=function j(c){return c.slice().sort(function(i,t){return i.orderNum-t.orderNum}).map(function(i){return F()(F()({},i),{},{children:i.children?j(i.children):[]})})},G=function j(c){var i=0;return c.forEach(function(t){t.orderNum>i&&(i=t.orderNum),t.children&&(i=Math.max(i,j(t.children)))}),i},P=function j(c){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;return c.filter(function(u){return u.name.toLowerCase().indexOf(i.toLowerCase())>-1}).map(function(u){return{isLeaf:!u.children||u.children.length===0,name:u.name,parentId:u.parentId,label:(0,f.hE)(u.name,i),icon:(0,x.jsx)(I,{icon:u.icon}),content:u.note,path:u.path,orderNum:u.orderNum,level:t,value:u.id,type:u.type,title:(0,x.jsxs)(x.Fragment,{children:[(0,f.hE)(u.name,i),V(u)]}),fullInfo:u,key:u.id,children:j(u.children,i,t+1)}})},z=function j(c){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return c.filter(function(u){return u.name.toLowerCase().indexOf(i.toLowerCase())>-1}).filter(function(u){return t?u.type!=="F":!1}).map(function(u){return{isLeaf:!u.children||u.children.length===0,name:u.name,parentId:u.parentId,label:(0,f.hE)(u.name,i),icon:(0,x.jsx)(I,{icon:u.icon}),content:u.note,path:u.path,value:u.id,title:(0,x.jsxs)(x.Fragment,{children:[(0,f.hE)(u.name,i),V(u)]}),fullInfo:u,key:u.id,children:j(u.children,i,t)}})}},2798:function(w,L,e){e.r(L),e.d(L,{default:function(){return ye}});var U=e(68166),F=e(15009),f=e.n(F),N=e(97857),n=e.n(N),K=e(99289),R=e.n(K),x=e(5574),I=e.n(x),k=e(3527),V=e(60982),Y=e(28712),G=e(63167),P=e(49881),z=e(69349),j=e(21953),c=e(58023),i=e(14737),t=e(41913),u=e(5075),ee=e(42075),X=e(14726),Q=e(85265),ne=e(35653),re=e(57953),te=e(32983),M=e(67294),r=e(85893),ae=u.Z.DirectoryTree,le=function(C){var O=C.open,g=C.onClose,v=C.onSubmit,y=C.values,S=(0,M.useState)(i.FJ),b=I()(S,2),T=b[0],m=b[1];(0,M.useEffect)(function(){O&&(0,j.Ri)(c.Z.ROLE_MENU_LIST,{id:y.id},function(){return m(function(s){return n()(n()({},s),{},{loading:!0})})},function(){return m(function(s){return n()(n()({},s),{},{loading:!1})})}).then(function(s){return m(function(o){return n()(n()({},o),{},{menuTreeData:s})})})},[y,O]);var A=(0,M.useCallback)(function(){g(),m(function(s){return n()(n()({},s),{},{menuTreeData:i.FJ.menuTreeData})})},[y]),W=function(){var s=R()(f()().mark(function o(){return f()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return m(function(h){return n()(n()({},h),{},{loading:!0})}),p.next=3,v(T.selectValue);case 3:m(function(h){return n()(n()({},h),{},{loading:!1,menuTreeData:i.FJ.menuTreeData})});case 4:case"end":return p.stop()}},o)}));return function(){return s.apply(this,arguments)}}(),D=function(){return(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)(ee.Z,{children:[(0,r.jsx)(X.ZP,{onClick:A,children:(0,t.l)("button.cancel")}),(0,r.jsx)(X.ZP,{type:"primary",loading:T.loading,onClick:W,children:(0,t.l)("button.submit")})]})})},B=(0,M.useCallback)(function(s){m(function(o){return n()(n()({},o),{},{searchValue:s.target.value})})},[T.searchValue]),$=function(o){m(function(E){return n()(n()({},E),{},{selectValue:o})})},d=(0,z.e9)((0,z.g9)(T.menuTreeData.menus),T.searchValue),a=function s(o){var E=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return o.forEach(function(p){var h=p.children;if(h&&h.length)return E.push(p),s(h,E);E.push(p)}),E},l=(0,M.useCallback)(function(s){var o=a(d);return s.filter(function(E){return o.some(function(p){return p.value==E&&p.isLeaf})})},[d]);return(0,r.jsx)(Q.Z,{title:(0,t.l)("role.assignMenu","",{roleName:y.roleName}),open:O,width:"55%",maskClosable:!1,onClose:A,extra:D(),children:T.menuTreeData.menus.length>0?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(ne.Z,{placeholder:(0,t.l)("global.search.text"),allowClear:!0,style:{marginBottom:16},value:T.searchValue,onChange:B}),(0,r.jsx)(re.Z,{spinning:T.loading,children:(0,r.jsx)(ae,{selectable:!0,defaultCheckedKeys:l(T.menuTreeData.selectedMenuIds),checkable:!0,defaultExpandAll:!0,onCheck:function(o,E){$(o==null?void 0:o.concat(E.halfCheckedKeys))},multiple:!0,className:"treeList",treeData:d})})]}):(0,r.jsx)(te.Z,{className:"code-content-empty"})})},ue=le,oe=e(29559),Z=e(81029),se=e(88028),ie=function(C){var O=(0,M.useRef)(),g=C.role,v=C.loading,y=C.userList,S=C.open,b=C.onClose;(0,M.useEffect)(function(){var m,A;(m=O.current)===null||m===void 0||(A=m.reload)===null||A===void 0||A.call(m)},[y,g]);var T=[{title:(0,t.l)("user.username"),dataIndex:"username",key:"username"},{title:(0,t.l)("user.nickname"),dataIndex:"nickname",key:"nickname"},{title:(0,t.l)("user.jobnumber"),dataIndex:"worknum"},{title:(0,t.l)("user.phone"),dataIndex:"mobile",hideInSearch:!0},{title:(0,t.l)("user.type"),dataIndex:"userType",valueEnum:(0,oe.a)(),hideInSearch:!0},{title:(0,t.l)("user.superAdminFlag"),dataIndex:"superAdminFlag",valueEnum:Z.ef,hideInSearch:!0,filters:Z.oF,filterMultiple:!1}];return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(Q.Z,{title:"".concat(g.roleName," - ").concat((0,t.l)("role.user.list")),width:"60%",open:S,maskClosable:!1,onClose:b,children:(0,r.jsx)(se.Z,{search:!1,pagination:!1,options:!1,rowKey:function(A){return A.id},actionRef:O,loading:v,dataSource:y,columns:T})})})},ce=ie,de=e(25538),J=e(79935),fe=e(7646),he=e(16894),me=e(66309),q=e(5966),ve=e(90672),ge=e(97269),xe=function(C){var O=C.values,g=C.form,v=function(){return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(q.Z,{name:"roleCode",label:(0,t.l)("role.roleCode"),placeholder:(0,t.l)("role.EnterRoleCode"),rules:[{required:!0,message:(0,t.l)("role.EnterRoleCode")}]}),(0,r.jsx)(q.Z,{name:"roleName",label:(0,t.l)("role.roleName"),placeholder:(0,t.l)("role.EnterRoleName"),rules:[{required:!0,message:(0,t.l)("role.EnterRoleName")}]}),(0,r.jsx)(ve.Z,{name:"note",label:(0,t.l)("global.table.note"),placeholder:(0,t.l)("role.EnterNote"),allowClear:!0})]})};return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(ge.A,n()(n()({},J.pA),{},{form:g,initialValues:O,submitter:!1,layout:"horizontal",children:v()}))})},Ce=xe,pe=e(18922),Ee=e(85576),Te=function(C){var O=pe.Z.useForm(),g=I()(O,1),v=g[0],y=M.useMemo(function(){return{resetForm:function(){return v.resetFields()}}},[v]),S=C.onSubmit,b=C.onCancel,T=C.modalVisible,m=C.values;(0,M.useEffect)(function(){v.setFieldsValue(m)},[T,m,v]);var A=function(){b(),y.resetForm()},W=function(){var D=R()(f()().mark(function B(){var $;return f()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,v.validateFields();case 2:$=a.sent,S(n()(n()({},m),$)),A();case 5:case"end":return a.stop()}},B)}));return function(){return D.apply(this,arguments)}}();return(0,r.jsx)(Ee.Z,n()(n()({},J.SU),{},{title:m.id?(0,t.l)("role.update"):(0,t.l)("role.create"),open:T,onCancel:function(){return A()},okButtonProps:{htmlType:"submit",autoFocus:!0},onOk:function(){return W()},children:(0,r.jsx)(Ce,{form:v,values:m})}))},_=Te,je=function(){var C=(0,M.useState)(i.Xt),O=I()(C,2),g=O[0],v=O[1],y=(0,M.useRef)(),S=function(){var d=R()(f()().mark(function a(l){var s,o;return f()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return v(function(h){return n()(n()({},h),{},{loading:!0})}),p.next=3,l();case 3:v(function(h){return n()(n()({},h),{},{loading:!1})}),(s=y.current)===null||s===void 0||(o=s.reload)===null||o===void 0||o.call(s);case 5:case"end":return p.stop()}},a)}));return function(l){return d.apply(this,arguments)}}(),b=function(){var d=R()(f()().mark(function a(l){return f()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,S(R()(f()().mark(function E(){return f()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.abrupt("return",(0,j.m0)(c.Z.ROLE_DELETE,l));case 1:case"end":return h.stop()}},E)})));case 2:case"end":return o.stop()}},a)}));return function(l){return d.apply(this,arguments)}}(),T=function(){var d=R()(f()().mark(function a(l){return f()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,S(R()(f()().mark(function E(){return f()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,(0,j.On)(c.Z.ROLE_ADDED_OR_UPDATE,n()(n()({},l),{},{tenantId:(0,fe.G_)()}),function(){},function(){return v(function(Ae){return n()(n()({},Ae),{},{addedOpen:!1})})});case 2:case"end":return h.stop()}},E)})));case 2:case"end":return o.stop()}},a)}));return function(l){return d.apply(this,arguments)}}(),m=function(){v(function(a){return n()(n()({},a),{},{addedOpen:!1,editOpen:!1,assignMenuOpen:!1,viewUsersOpen:!1})})},A=function(){var d=R()(f()().mark(function a(l){return f()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,S(R()(f()().mark(function E(){return f()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,(0,j.vO)(c.Z.ROLE_ASSIGN_MENU,(0,t.l)("role.assign"),{roleId:g.value.id,menuIds:l},function(){return m()});case 2:case"end":return h.stop()}},E)})));case 2:case"end":return o.stop()}},a)}));return function(l){return d.apply(this,arguments)}}(),W=function(a){v(function(l){return n()(n()({},l),{},{value:a,editOpen:!0})})},D=function(a){v(function(l){return n()(n()({},l),{},{value:a,assignMenuOpen:!0})})},B=function(a){(0,j.Ri)(c.Z.ROLE_USER_LIST,{roleId:a.id}).then(function(l){return v(function(s){return n()(n()({},s),{},{roleUserList:l,value:a,viewUsersOpen:!0})})})},$=[{title:(0,t.l)("role.roleCode"),dataIndex:"roleCode",render:function(a,l){return(0,P.ux)(Z.k5.AUTH_ROLE_VIEW_USER_LIST)?(0,r.jsxs)("a",{onClick:function(){return B(l)},children:[" ",l.roleCode," "]}):(0,r.jsxs)("span",{children:[" ",l.roleCode," "]})}},{title:(0,t.l)("role.roleName"),dataIndex:"roleName"},{title:(0,t.l)("role.belongTenant"),hideInSearch:!0,render:function(a,l){return(0,r.jsx)(me.Z,{color:"blue",children:l.tenant.tenantCode})}},{title:(0,t.l)("global.table.note"),dataIndex:"note",hideInSearch:!0,ellipsis:!0},{title:(0,t.l)("global.table.createTime"),dataIndex:"createTime",sorter:!0,hideInSearch:!0,valueType:"dateTime"},{title:(0,t.l)("global.table.updateTime"),dataIndex:"updateTime",sorter:!0,hideInSearch:!0,valueType:"dateTime"},{title:(0,t.l)("global.table.operate"),valueType:"option",width:"10%",fixed:"right",render:function(a,l){return[(0,r.jsx)(P.FY,{path:Z.k5.AUTH_ROLE_EDIT,children:(0,r.jsx)(Y.m,{onClick:function(){return W(l)}},"".concat(l.id,"_edit"))},"".concat(l.id,"_add_auth")),(0,r.jsx)(P.FY,{path:Z.k5.AUTH_ROLE_DELETE,children:(0,r.jsx)(r.Fragment,{children:l.id!==1&&(0,r.jsx)(G.i,{onClick:function(){return b(l.id)},description:(0,t.l)("role.deleteConfirm")},"".concat(l.id,"_delete"))})},"".concat(l.id,"_delete_auth")),(0,r.jsx)(P.FY,{path:Z.k5.AUTH_ROLE_ASSIGN_MENU,children:(0,r.jsx)(k.F,{onClick:function(){return D(l)},title:(0,t.l)("role.assignMenu","",{roleName:l.roleName})},"".concat(l.id,"_ass"))},"".concat(l.id,"_assignMenu_auth"))]}}];return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(he.ZP,n()(n()({},J.xc),{},{headerTitle:(0,t.l)("role.roleManagement"),actionRef:y,loading:g.loading,toolBarRender:function(){return[(0,r.jsx)(P.FY,{path:Z.k5.AUTH_ROLE_ADD,children:(0,r.jsx)(V.q,{onClick:function(){return v(function(l){return n()(n()({},l),{},{addedOpen:!0})})}},"toolBarRender")},"roleadd")]},request:function(a,l,s){return(0,de.et)(c.Z.ROLE,n()(n()({},a),{},{sorter:l,filter:s}))},columns:$})),(0,r.jsx)(_,{onSubmit:function(a){return T(a)},onCancel:function(){return m()},modalVisible:g.addedOpen,values:{}}),(0,r.jsx)(_,{onSubmit:function(a){return T(a)},onCancel:function(){return m()},modalVisible:g.editOpen,values:g.value}),Object.keys(g.value).length>0&&(0,r.jsx)(ue,{values:g.value,open:g.assignMenuOpen,onSubmit:A,onClose:function(){return v(function(a){return n()(n()({},a),{},{assignMenuOpen:!1})})}}),Object.keys(g.value).length>0&&(0,r.jsx)(ce,{role:g.value,open:g.viewUsersOpen,userList:g.roleUserList,loading:g.loading,onClose:function(){return v(function(a){return n()(n()({},a),{},{viewUsersOpen:!1})})}})]})},Re=je,Oe=e(11774),ye=function(){return(0,r.jsx)(U.Z,{children:(0,r.jsx)(Oe._z,{title:!1,children:(0,r.jsx)(Re,{})})})}},29559:function(w,L,e){e.d(L,{F:function(){return U},a:function(){return F}});var U={LOCAL:0,LDAP:1},F=function(){return{0:"LOCAL",1:"LDAP"}}}}]);
